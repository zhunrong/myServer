(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{179:function(e,t,r){var i=r(180);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(18)(i,o);i.locals&&(e.exports=i.locals)},180:function(e,t,r){(t=e.exports=r(17)(!1)).i(r(181),""),t.i(r(182),""),t.push([e.i,".markdownEditor-1PpA2{height:100vh;position:relative}.markdownEditor-1PpA2 .article-title{height:60px;border-bottom:1px solid #ccc;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;padding:0 15px;-webkit-box-pack:justify;justify-content:space-between}.markdownEditor-1PpA2 .article-title input{height:50px;font-size:24px;font-weight:bold;width:60%;display:block}.markdownEditor-1PpA2 .article-title .update-time{color:#ccc;margin-right:10px;vertical-align:bottom;font-size:12px}.markdownEditor-1PpA2 .editor-content{position:absolute;width:100%;top:60px;bottom:40px;display:-webkit-box;display:flex}.markdownEditor-1PpA2 .editor-content .codemirror-wrapper{width:40%;position:relative}.markdownEditor-1PpA2 .editor-content .codemirror-wrapper .react-codemirror2{height:100%}.markdownEditor-1PpA2 .editor-content .codemirror-wrapper .react-codemirror2 .CodeMirror{height:100%}.markdownEditor-1PpA2 .editor-content .markdown-parser{-webkit-box-flex:1;flex:1;padding:0 15px;overflow-y:auto}.markdownEditor-1PpA2 .bottom-bars{position:absolute;border-top:1px solid #ccc;box-sizing:border-box;left:0;bottom:0;width:100%;height:40px;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;padding:0 10px}.markdownEditor-1PpA2 .bottom-bars .picture-icon{font-size:20px}\n",""]),t.locals={editor:"markdownEditor-1PpA2"}},217:function(e,t,r){"use strict";r.r(t);var i=r(30),o=r.n(i),a=r(0),n=r.n(a),s=r(13),c=r(1),p=r(99),d=r(11),l=r(66),h=r.n(l),m=r(179),g=r.n(m),u=(r(74),r(183),r(33)),b=r(12),A=r(28),f=r.n(A),x=r(40);const C=80;class w extends a.Component{constructor(e){super(e),o()(this,"state",{title:"",source:"",articleId:"",saving:!1,updateTime:""}),o()(this,"editor",void 0),o()(this,"handleTitleInput",e=>{const t=e.target.value;this.setState({title:t}),t.length>=C&&d.message.warn(`标题长度最大为${C}个字符!`)}),o()(this,"saveOrCreate",async e=>{const{title:t,articleId:r,source:i}=this.state;if(this.saving=!0,r){const{status:e,message:o,data:a}=await Object(u.b)(r,{title:t,markdown:i});"error"===e?d.message.error(o):this.setState({updateTime:a.updateTime})}else{const{status:e,data:r,message:o}=await Object(u.a)(t,i);"success"===e?(this.setState({articleId:r.id,updateTime:r.updateTime}),Object(b.d)(r.id)):d.message.error(o)}this.saving=!1}),o()(this,"handlePictureUploaded",e=>{const t=this.editor.getDoc(),r=t.getCursor(),i=`![${e.originFilename}](https://${e.key})`;t.replaceRange(i,r)}),this.props.login?(this.state.articleId=Object(b.a)(),this.getArticleDetail()):this.props.history.goBack()}get saving(){return this.state.saving}set saving(e){this.setState({saving:e})}async getArticleDetail(){const{articleId:e}=this.state;if(!e)return;const{status:t,message:r,data:i}=await Object(u.c)(e);"success"===t?this.setState({title:i.title,source:i.markdown,updateTime:i.updateTime}):d.message.error(r)}render(){const{title:e,source:t,articleId:r,saving:i,updateTime:o}=this.state;return n.a.createElement("div",{className:g.a.editor},n.a.createElement("div",{className:"article-title"},n.a.createElement("input",{value:e,type:"text",placeholder:"输入文章标题...",maxLength:C,onChange:this.handleTitleInput}),n.a.createElement("div",{className:"tools"},o&&n.a.createElement("span",{className:"update-time"},"保存时间：",f()(o).format("YYYY年MM月DD日 HH:mm:ss")),n.a.createElement(d.Button,{htmlType:"button",type:"primary",loading:i,ghost:!0,onClick:this.saveOrCreate},r?"保存":"新建"))),n.a.createElement("div",{className:"editor-content"},n.a.createElement("div",{className:"codemirror-wrapper"},n.a.createElement(p.Controlled,{editorDidMount:e=>this.editor=e,value:t,options:{mode:"markdown",theme:"monokai",lineNumbers:!0,lineWrapping:!0},onBeforeChange:(e,t,r)=>{this.setState({source:r})}})),n.a.createElement(h.a,{className:"markdown-parser markdown-style",source:t,sourcePos:!1})),n.a.createElement("div",{className:"bottom-bars"},n.a.createElement(x.a,{bucketType:"user",onUploaded:this.handlePictureUploaded},n.a.createElement(d.Icon,{type:"picture",className:"picture-icon"}))))}}t.default=Object(c.withRouter)(Object(s.b)((function(e){return{login:e.common.login}}))(w))},31:function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"g",(function(){return n})),r.d(t,"e",(function(){return s})),r.d(t,"f",(function(){return c})),r.d(t,"a",(function(){return p})),r.d(t,"c",(function(){return d}));var i=r(32);function o(e,t){return Object(i.a)({url:"/article",method:"post",data:{title:e,markdown:t}})}function a(e,t={}){return Object(i.a)({url:`/article/${e}`,method:"put",data:t})}function n(e,t){return Object(i.a)({url:"/article",params:{pageSize:e,page:t}})}function s(e,t){return Object(i.a)({url:"/allArticle",params:{pageSize:e,page:t}})}function c(e){return Object(i.a)({url:`/article/${e}`})}function p(e,t){return Object(i.a)({url:"/articleVisit",method:"post",data:{articleId:e,userId:t}})}function d(e){return Object(i.a)({url:"/articleDelete",method:"post",data:{ids:e}})}},32:function(e,t,r){"use strict";var i=r(44),o=r.n(i),a=r(3),n=r(11),s=r(12),c=r(45);const p=o.a.create({baseURL:a.a.HTTP_BASE_URL,validateStatus:e=>e>=200&&e<500});t.a=async function(e){const t=Object(s.b)(),r=t?Object(c.merge)({headers:{Authorization:`Bearer ${t}`}},e):e,{data:i,status:o}=await p(r);if(401===o){const e="401";n.notification.error({message:"您未登录或者登录已失效",description:"点我重新登录",duration:null,style:{cursor:"pointer"},key:e,onClick(){location.replace("#/login"),n.notification.close(e)}})}return Promise.resolve(i)}},33:function(e,t,r){"use strict";r.d(t,"g",(function(){return a})),r.d(t,"d",(function(){return n})),r.d(t,"i",(function(){return s})),r.d(t,"e",(function(){return c})),r.d(t,"h",(function(){return p})),r.d(t,"f",(function(){return d}));var i=r(32),o=r(31);function a(e,t){return Object(i.a)({url:"/login",method:"post",data:{email:e,password:t}})}function n(){return Object(i.a)({url:"/user"})}function s(e,t){return Object(i.a)({url:"/user",method:"put",data:{avatar:t,nickname:e}})}function c(e){return Object(i.a)({url:"/mailVerifyCode",method:"post",data:{email:e}})}function p(e,t,r){return Object(i.a)({url:"/register",method:"post",data:{email:e,password:t,verifyCode:r}})}function d(e){return Object(i.a)({url:"/qcloud/uploadCredential",params:{type:e}})}r.d(t,"a",(function(){return o.b})),r.d(t,"b",(function(){return o.d})),r.d(t,"c",(function(){return o.f}))},37:function(e,t,r){var i=r(38);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(18)(i,o);i.locals&&(e.exports=i.locals)},38:function(e,t,r){(t=e.exports=r(17)(!1)).push([e.i,".ReactCrop{position:relative;display:inline-block;cursor:crosshair;overflow:hidden;max-width:100%;background-color:#000}.ReactCrop:focus{outline:none}.ReactCrop--disabled,.ReactCrop--locked{cursor:inherit}.ReactCrop__image{display:block;max-width:100%;max-height:-webkit-fill-available;max-height:-moz-available;max-height:fill-available}.ReactCrop--crop-invisible .ReactCrop__image{opacity:0.5}.ReactCrop__crop-selection{position:absolute;top:0;left:0;-webkit-transform:translate3d(0, 0, 0);transform:translate3d(0, 0, 0);box-sizing:border-box;cursor:move;box-shadow:0 0 0 9999em rgba(0,0,0,0.5);border:1px solid;border-image-source:url(\"data:image/gif;base64,R0lGODlhCgAKAJECAAAAAP///////wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OEI5RDc5MTFDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OEI5RDc5MTBDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBQoAAgAsAAAAAAoACgAAAhWEERkn7W3ei7KlagMWF/dKgYeyGAUAIfkEBQoAAgAsAAAAAAoACgAAAg+UYwLJ7RnQm7QmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYgLJHdiinNSAVfOEKoUCACH5BAUKAAIALAAAAAAKAAoAAAIRVISAdusPo3RAzYtjaMIaUQAAIfkEBQoAAgAsAAAAAAoACgAAAg+MDiem7Q8bSLFaG5il6xQAIfkEBQoAAgAsAAAAAAoACgAAAg+UYRLJ7QnQm7SmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYBLJDdiinNSEVfOEKoECACH5BAUKAAIALAAAAAAKAAoAAAIRFISBdusPo3RBzYsjaMIaUQAAOw==\");border-image-slice:1;border-image-repeat:repeat}.ReactCrop--disabled .ReactCrop__crop-selection{cursor:inherit}.ReactCrop__drag-handle{position:absolute;width:9px;height:9px;background-color:rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.7);box-sizing:border-box;outline:1px solid transparent}.ReactCrop .ord-nw{top:0;left:0;margin-top:-5px;margin-left:-5px;cursor:nw-resize}.ReactCrop .ord-n{top:0;left:50%;margin-top:-5px;margin-left:-5px;cursor:n-resize}.ReactCrop .ord-ne{top:0;right:0;margin-top:-5px;margin-right:-5px;cursor:ne-resize}.ReactCrop .ord-e{top:50%;right:0;margin-top:-5px;margin-right:-5px;cursor:e-resize}.ReactCrop .ord-se{bottom:0;right:0;margin-bottom:-5px;margin-right:-5px;cursor:se-resize}.ReactCrop .ord-s{bottom:0;left:50%;margin-bottom:-5px;margin-left:-5px;cursor:s-resize}.ReactCrop .ord-sw{bottom:0;left:0;margin-bottom:-5px;margin-left:-5px;cursor:sw-resize}.ReactCrop .ord-w{top:50%;left:0;margin-top:-5px;margin-left:-5px;cursor:w-resize}.ReactCrop__disabled .ReactCrop__drag-handle{cursor:inherit}.ReactCrop__drag-bar{position:absolute}.ReactCrop__drag-bar.ord-n{top:0;left:0;width:100%;height:6px;margin-top:-3px}.ReactCrop__drag-bar.ord-e{right:0;top:0;width:6px;height:100%;margin-right:-3px}.ReactCrop__drag-bar.ord-s{bottom:0;left:0;width:100%;height:6px;margin-bottom:-3px}.ReactCrop__drag-bar.ord-w{top:0;left:0;width:6px;height:100%;margin-left:-3px}.ReactCrop--new-crop .ReactCrop__drag-bar,.ReactCrop--new-crop .ReactCrop__drag-handle,.ReactCrop--fixed-aspect .ReactCrop__drag-bar{display:none}.ReactCrop--fixed-aspect .ReactCrop__drag-handle.ord-n,.ReactCrop--fixed-aspect .ReactCrop__drag-handle.ord-e,.ReactCrop--fixed-aspect .ReactCrop__drag-handle.ord-s,.ReactCrop--fixed-aspect .ReactCrop__drag-handle.ord-w{display:none}@media (max-width: 768px), (pointer: coarse){.ReactCrop__drag-handle{width:17px;height:17px}.ReactCrop .ord-nw{margin-top:-9px;margin-left:-9px}.ReactCrop .ord-n{margin-top:-9px;margin-left:-9px}.ReactCrop .ord-ne{margin-top:-9px;margin-right:-9px}.ReactCrop .ord-e{margin-top:-9px;margin-right:-9px}.ReactCrop .ord-se{margin-bottom:-9px;margin-right:-9px}.ReactCrop .ord-s{margin-bottom:-9px;margin-left:-9px}.ReactCrop .ord-sw{margin-bottom:-9px;margin-left:-9px}.ReactCrop .ord-w{margin-top:-9px;margin-left:-9px}.ReactCrop__drag-bar.ord-n{height:14px;margin-top:-7px}.ReactCrop__drag-bar.ord-e{width:14px;margin-right:-7px}.ReactCrop__drag-bar.ord-s{height:14px;margin-bottom:-7px}.ReactCrop__drag-bar.ord-w{width:14px;margin-left:-7px}}.imageCropper-38CPD{display:inline-block;font-size:0;line-height:0}.imageCropper-38CPD.active::before{content:'';position:fixed;top:0;bottom:0;left:0;right:0;z-index:9998;background:rgba(255,255,255,0.5)}.imageCropper-38CPD .selector{position:relative;display:inline-block;cursor:pointer}.imageCropper-38CPD .selector input{position:absolute;top:0;left:0;opacity:0;z-index:1;width:100%;height:100%;display:block;cursor:pointer}.imageCropper-38CPD .selector .default-select{width:50px;height:50px;border-radius:3px;border:1px dashed #333333;display:block;position:relative;cursor:pointer}.imageCropper-38CPD .selector .default-select::before{content:'';position:absolute;width:2px;margin-left:-1px;height:50%;background-color:#333333;left:50%;top:25%;z-index:0;border-radius:1px}.imageCropper-38CPD .selector .default-select::after{content:'';position:absolute;height:2px;margin-top:-1px;width:50%;background-color:#333333;top:50%;left:25%;z-index:0;border-radius:1px}.crop-wrapper{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);box-shadow:0px 5px 16px 0px rgba(0,0,0,0.95);z-index:9999}.crop-wrapper .ReactCrop{display:block}.crop-wrapper .tools{position:absolute;bottom:0;width:100%;padding:10px;left:0;color:white;background:-webkit-gradient(linear, left top, left bottom, color-stop(0, rgba(0,0,0,0)), to(rgba(0,0,0,0.5)));background:linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,0.5) 100%);display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;flex-direction:row-reverse}.crop-wrapper .tools button{cursor:pointer;border:1px dashed #fff;margin:0 3px;font-size:12px;line-height:20px}.crop-wrapper .tools button:hover{background:#fff;color:#999}\n",""]),t.locals={cropper:"imageCropper-38CPD"}},40:function(e,t,r){"use strict";var i=r(30),o=r.n(i),a=r(0),n=r.n(a),s=r(14),c=r.n(s),p=r(49),d=r.n(p),l=r(37),h=r.n(l);class m extends a.PureComponent{constructor(e){super(e),o()(this,"state",{originalSrc:"",crop:{x:0,y:0}}),o()(this,"originalFileName",""),o()(this,"image",void 0),o()(this,"pixelCrop",void 0),o()(this,"inputRef",n.a.createRef()),o()(this,"handleFileInput",e=>{const t=e.target.files&&e.target.files[0];if(t)if(this.originalFileName=t.name,"image/gif"===t.type){const{onConfirm:e}=this.props;e&&e(t)}else{const e=new FileReader;e.readAsDataURL(t),e.onload=()=>{this.setState({originalSrc:e.result})}}}),o()(this,"handleCropChange",(e,t)=>{this.setState({crop:e}),this.pixelCrop=t}),o()(this,"handleImageloaded",(e,t)=>{this.image=e,this.pixelCrop=t}),o()(this,"getCroppedImg",(e,t,r)=>{const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");return o&&o.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),new Promise((e,t)=>{i.toBlob(t=>{t.name=r,e(t)},"image/jpeg")})}),o()(this,"confirm",async()=>{const{onConfirm:e}=this.props;if(this.image&&this.pixelCrop&&e){this.pixelCrop.width=this.pixelCrop.width||this.image.naturalWidth,this.pixelCrop.height=this.pixelCrop.height||this.image.naturalHeight,e(await this.getCroppedImg(this.image,this.pixelCrop,this.originalFileName))}this.cancel()}),o()(this,"cancel",()=>{this.setState({originalSrc:""}),this.inputRef.current&&(this.inputRef.current.value="")}),e.crop&&(this.state.crop=e.crop)}render(){const{originalSrc:e,crop:t}=this.state,{children:r}=this.props;let i;return e&&(i=n.a.createElement("div",{className:"crop-wrapper"},n.a.createElement(d.a,{src:e,crop:t,onImageLoaded:this.handleImageloaded,onChange:this.handleCropChange}),n.a.createElement("div",{className:"tools"},n.a.createElement("button",{type:"button",onClick:this.confirm},"确定"),n.a.createElement("button",{type:"button",onClick:this.cancel},"取消")))),n.a.createElement("div",{className:`${h.a.cropper} ${e?"active":""}`},n.a.createElement("div",{className:"selector"},r||n.a.createElement("span",{className:"default-select"}),n.a.createElement("input",{ref:this.inputRef,type:"file",onInput:this.handleFileInput,accept:"image/*"})),c.a.createPortal(i,document.body))}}var g=m,u=r(50),b=r.n(u),A=r(33),f=r(11);class x extends a.PureComponent{constructor(e){super(e),o()(this,"cos",void 0),o()(this,"file",void 0),o()(this,"credential",{TmpSecretId:"",TmpSecretKey:"",XCosSecurityToken:"",ExpiredTime:0}),o()(this,"region",""),o()(this,"bucket",""),o()(this,"directory",""),o()(this,"domain",""),o()(this,"upload",()=>{const{onUploaded:e,uploadDir:t,bucketType:r}=this.props;if("user"!==r&&!t)return console.warn("上传目录未指定");const i=this.directory||t,o=`${Date.now()}_${this.file.name}`;this.cos.putObject({Bucket:this.bucket,Region:this.region,Key:`${i}/${o}`,Body:this.file,onProgress(e){const{loaded:t,total:r,speed:i,percent:o}=e;console.log("percent ::",o)}},(t,r)=>{if(t)return console.log(t);const{Location:i}=r;e&&e({key:i,directory:this.directory,filename:o,originFilename:this.file.name,domain:this.domain})})}),o()(this,"handleConfirm",e=>{this.file=e,this.upload()}),this.cos=new b.a({getAuthorization:async(e,t)=>{t(await this.getCredential())}}),this.getCredential()}async getCredential(){const{bucketType:e}=this.props;if(this.credential.ExpiredTime<Date.now()){const{status:t,message:r,data:i}=await Object(A.f)(e);return"success"===t?(this.credential={TmpSecretId:i.credentials&&i.credentials.tmpSecretId,TmpSecretKey:i.credentials&&i.credentials.tmpSecretKey,XCosSecurityToken:i.credentials&&i.credentials.sessionToken,ExpiredTime:1e3*i.expiredTime},this.region=i.region,this.bucket=i.bucket,this.directory=i.directory,this.domain=i.domain,this.credential):(f.message.error(r),{})}return this.credential}render(){const{children:e,crop:t}=this.props;return n.a.createElement(g,{onConfirm:this.handleConfirm,crop:t},e)}}t.a=x}}]);